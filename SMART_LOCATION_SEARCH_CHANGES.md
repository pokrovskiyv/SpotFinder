# Smart Location Search - –†–µ–∞–ª–∏–∑–∞—Ü–∏—è

## –ü—Ä–æ–±–ª–µ–º–∞
–ë–æ—Ç –≤–æ–∑–≤—Ä–∞—â–∞–ª —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –∏–∑ —Ä–∞–∑–Ω—ã—Ö —Å—Ç—Ä–∞–Ω (–°–µ—Ä–±–∏—è, –£–∫—Ä–∞–∏–Ω–∞), –∏–≥–Ω–æ—Ä–∏—Ä—É—è –ø–∞—Ä–∞–º–µ—Ç—Ä —Ä–∞–¥–∏—É—Å–∞, –ø–æ—Ç–æ–º—É —á—Ç–æ Google Places API Text Search –∏—â–µ—Ç –≥–ª–æ–±–∞–ª—å–Ω–æ –ø–æ —Ç–µ–∫—Å—Ç–æ–≤—ã–º —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è–º.

## –†–µ—à–µ–Ω–∏–µ
–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ —Å–∏—Å—Ç–µ–º–∞ —É–º–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞ —Å –∞–¥–∞–ø—Ç–∏–≤–Ω—ã–º —Ä–∞–¥–∏—É—Å–æ–º –∏ —Å—Ç—Ä–æ–≥–æ–π –≥–µ–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–æ–π —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–µ–π.

### –ò–∑–º–µ–Ω–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

#### 1. `supabase/functions/_shared/geo-utils.ts` (–Ω–æ–≤—ã–π)
- **calculateDistance()** - –≤—ã—á–∏—Å–ª–µ–Ω–∏–µ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏—è –ø–æ —Ñ–æ—Ä–º—É–ª–µ Haversine
- **filterByDistance()** - —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –º–µ—Å—Ç –ø–æ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–º—É —Ä–∞—Å—Å—Ç–æ—è–Ω–∏—é (—Å—Ç—Ä–æ–≥–æ –¥–æ 5–∫–º)
- **sortByDistance()** - —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –ø–æ –±–ª–∏–∑–æ—Å—Ç–∏
- **filterAndSort()** - –∫–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –∏ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏

#### 2. `supabase/functions/_shared/constants.ts`
–î–æ–±–∞–≤–ª–µ–Ω—ã –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã:
- `SEARCH_RADIUS_STEPS` - —à–∞–≥–∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è —Ä–∞–¥–∏—É—Å–∞ [1000, 2000, 3000, 5000]
- `MIN_RESULTS_THRESHOLD` - –º–∏–Ω–∏–º—É–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –¥–ª—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ (3)

#### 3. `supabase/functions/_shared/gemini-client.ts`
–ü–µ—Ä–µ—Ä–∞–±–æ—Ç–∞–Ω –º–µ—Ç–æ–¥ `searchPlaces()` —Å –Ω–æ–≤–æ–π –ª–æ–≥–∏–∫–æ–π:

**–ê–ª–≥–æ—Ä–∏—Ç–º:**
1. **Nearby Search** - –ø—ã—Ç–∞–µ—Ç—Å—è –Ω–∞–π—Ç–∏ –º–µ—Å—Ç–∞ —Å—Ç—Ä–æ–≥–æ –ø–æ —Ä–∞–¥–∏—É—Å—É (–±–æ–ª–µ–µ —Ç–æ—á–Ω—ã–π, –Ω–æ –º–µ–Ω–µ–µ –≥–∏–±–∫–∏–π)
2. –ï—Å–ª–∏ –Ω–∞–π–¥–µ–Ω–æ ‚â•3 –º–µ—Å—Ç - –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∏—Ö
3. –ï—Å–ª–∏ –º–∞–ª–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ - –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –∫ **Text Search** —Å —Ä–∞—Å—à–∏—Ä—è—é—â–∏–º—Å—è —Ä–∞–¥–∏—É—Å–æ–º
4. –î–ª—è –∫–∞–∂–¥–æ–≥–æ —Ä–∞–¥–∏—É—Å–∞ (1–∫–º, 2–∫–º, 3–∫–º, 5–∫–º):
   - –í—ã–ø–æ–ª–Ω—è–µ—Ç Text Search
   - –í—ã—á–∏—Å–ª—è–µ—Ç —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
   - –§–∏–ª—å—Ç—Ä—É–µ—Ç —Å—Ç—Ä–æ–≥–æ –ø–æ MAX_SEARCH_RADIUS (5–∫–º)
   - –ï—Å–ª–∏ –Ω–∞—à–ª–æ—Å—å ‚â•5 —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ - –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∏—Ö
5. –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –≤—Å–µ –Ω–∞–π–¥–µ–Ω–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã, —Å—Ç—Ä–æ–≥–æ –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø–æ 5–∫–º

–î–æ–±–∞–≤–ª–µ–Ω—ã –º–µ—Ç–æ–¥—ã:
- **nearbySearch()** - —Å—Ç—Ä–æ–≥–∏–π –ø–æ–∏—Å–∫ –ø–æ —Ä–∞–¥–∏—É—Å—É
- **textSearch()** - –ø–æ–∏—Å–∫ –ø–æ —Ç–µ–∫—Å—Ç—É (–ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω –∏–∑ —Å—Ç–∞—Ä–æ–≥–æ searchPlaces)

#### 4. `supabase/functions/_shared/types.ts`
–î–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–ª–µ `geometry` –≤ `PlaceResult`:
```typescript
geometry?: {
  location: {
    lat: number;
    lng: number;
  };
}
```

#### 5. `supabase/functions/_shared/orchestrator.ts`
–î–æ–±–∞–≤–ª–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏:
```typescript
console.log('Search results with distances:', places.map(p => 
  `${p.name} - ${p.distance ? p.distance + 'm' : 'unknown distance'}`
));
```

## –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞

1. **–ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å** - –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å 1–∫–º, —Ä–∞—Å—à–∏—Ä—è–µ—Ç—Å—è –¥–æ 5–∫–º –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏
2. **–°—Ç—Ä–æ–≥–∞—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è** - –ù–ò–ö–û–ì–î–ê –Ω–µ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –¥–∞–ª—å—à–µ 5–∫–º
3. **–†–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç—å** - –∫–æ–º–±–∏–Ω–∞—Ü–∏—è Nearby Search (—Ç–æ—á–Ω—ã–π) –∏ Text Search (–≥–∏–±–∫–∏–π)
4. **–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞** - —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤—Å–µ–≥–¥–∞ –æ—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã –ø–æ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏—é
5. **–ò–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω–æ—Å—Ç—å** - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ –¥–æ –∫–∞–∂–¥–æ–≥–æ –º–µ—Å—Ç–∞

## –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç

–ó–∞–ø—Ä–æ—Å "–ù–∞–π–¥–∏ —á—Ç–æ-—Ç–æ –Ω–µ–¥–æ—Ä–æ–≥–æ–µ –∏ —É—é—Ç–Ω–æ–µ —Ä—è–¥–æ–º —Å–æ –º–Ω–æ–π" –∏–∑ –ù–æ–≤–∏ –°–∞–¥–∞ —Ç–µ–ø–µ—Ä—å –≤–µ—Ä–Ω–µ—Ç:
- ‚úÖ –¢–û–õ–¨–ö–û –º–µ—Å—Ç–∞ –≤ –ù–æ–≤–∏ –°–∞–¥–µ
- ‚úÖ –í —Ä–∞–¥–∏—É—Å–µ –¥–æ 5–∫–º –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- ‚úÖ –û—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø–æ –±–ª–∏–∑–æ—Å—Ç–∏
- ‚úÖ –° —É–∫–∞–∑–∞–Ω–∏–µ–º —Ä–∞—Å—Å—Ç–æ—è–Ω–∏—è

## –ü—Ä–∏–º–µ—Ä –≤—ã–≤–æ–¥–∞

```
1. IKIGAI
‚≠ê 4.4 ‚Ä¢ üí∞üí∞ ‚Ä¢ ‚úÖ –û—Ç–∫—Ä—ã—Ç–æ ‚Ä¢ 120m
üìç –î—Ä –°–≤–µ—Ç–∏—Å–ª–∞–≤–∞ –ö–∞—Å–∞–ø–∏–Ω–æ–≤–∏—õ–∞ 18, –ù–æ–≤–∏ –°–∞–¥ 21100, –°–µ—Ä–±–∏—è

2. Corso Caf√© & Restaurant
‚≠ê 4.4 ‚Ä¢ üí∞üí∞ ‚Ä¢ ‚úÖ –û—Ç–∫—Ä—ã—Ç–æ ‚Ä¢ 450m
üìç –ó–º–∞—ò –à–æ–≤–∏–Ω–∞ 17, –ù–æ–≤–∏ –°–∞–¥ 21000, –°–µ—Ä–±–∏—è

3. MARIPAVLE
‚≠ê 4.9 ‚Ä¢ ‚úÖ –û—Ç–∫—Ä—ã—Ç–æ ‚Ä¢ 780m
üìç –ã–∏—Ä–ø–∞–Ω–æ–≤–∞ 5, –ù–æ–≤–∏ –°–∞–¥, –°–µ—Ä–±–∏—è
```

–í–º–µ—Å—Ç–æ —Å—Ç–∞—Ä—ã—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –∏–∑ –£–∫—Ä–∞–∏–Ω—ã.

