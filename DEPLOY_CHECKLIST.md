# ‚úÖ –ß–µ–∫-–ª–∏—Å—Ç —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è —Å–∏—Å—Ç–µ–º—ã –∞–Ω–∞–ª–∏—Ç–∏–∫–∏

## üìã –ü—Ä–æ–≤–µ—Ä–∫–∞ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ –∫–æ–¥–∞

- [x] –ú–∏–≥—Ä–∞—Ü–∏—è 005 –æ–±–Ω–æ–≤–ª–µ–Ω–∞ (results_count, top_result)
- [x] –ú–∏–≥—Ä–∞—Ü–∏—è 008 —Å–æ–∑–¥–∞–Ω–∞ (user_actions —Ç–∞–±–ª–∏—Ü–∞)
- [x] PlaceCacheManager —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω
- [x] UserActionTracker —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω
- [x] GeminiClient –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω —Å –∫—ç—à–µ–º
- [x] Orchestrator –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω —Å —Ç—Ä–µ–∫–∏–Ω–≥–æ–º
- [x] SessionManager –∏—Å–ø—Ä–∞–≤–ª–µ–Ω
- [x] Types –æ–±–Ω–æ–≤–ª–µ–Ω—ã
- [x] –¢–µ—Å—Ç—ã —Å–æ–∑–¥–∞–Ω—ã
- [x] –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –≥–æ—Ç–æ–≤–∞

## üöÄ –®–∞–≥–∏ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è

### 1. –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

**–í Supabase Dashboard ‚Üí SQL Editor –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:**

```sql
-- –®–∞–≥ 1.1: –û–±–Ω–æ–≤–∏—Ç—å search_history
ALTER TABLE search_history 
ADD COLUMN IF NOT EXISTS results_count INT DEFAULT 0,
ADD COLUMN IF NOT EXISTS top_result JSONB NULL;

-- –®–∞–≥ 1.2: –°–æ–∑–¥–∞—Ç—å user_actions (–≤—ã–ø–æ–ª–Ω–∏—Ç—å –≤–µ—Å—å —Ñ–∞–π–ª 008_create_user_actions_table.sql)
-- –°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –∏–∑ supabase/migrations/008_create_user_actions_table.sql
```

### 2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π

```sql
-- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å search_history
SELECT column_name, data_type 
FROM information_schema.columns 
WHERE table_name = 'search_history'
ORDER BY ordinal_position;

-- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å user_actions
SELECT column_name, data_type 
FROM information_schema.columns 
WHERE table_name = 'user_actions'
ORDER BY ordinal_position;
```

–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:
- search_history –¥–æ–ª–∂–Ω–∞ —Å–æ–¥–µ—Ä–∂–∞—Ç—å: `results_count`, `top_result`
- user_actions –¥–æ–ª–∂–Ω–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞—Ç—å —Å–æ –≤—Å–µ–º–∏ –ø–æ–ª—è–º–∏

### 3. –û–±–Ω–æ–≤–∏—Ç—å Edge Functions

**–í–∞—Ä–∏–∞–Ω—Ç A: –ß–µ—Ä–µ–∑ GitHub (–µ—Å–ª–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –¥–µ–ø–ª–æ–π)**
```bash
git add .
git commit -m "feat: add analytics and caching system"
git push origin main
```

**–í–∞—Ä–∏–∞–Ω—Ç B: –ß–µ—Ä–µ–∑ Dashboard UI**
1. Edge Functions ‚Üí telegram-webhook
2. –û–±–Ω–æ–≤–∏—Ç—å –≤—Å–µ —Ñ–∞–π–ª—ã –∏–∑ `supabase/functions/telegram-webhook/`
3. –û–±–Ω–æ–≤–∏—Ç—å –≤—Å–µ —Ñ–∞–π–ª—ã –∏–∑ `supabase/functions/_shared/`
4. Deploy

**–í–∞—Ä–∏–∞–Ω—Ç C: –ß–µ—Ä–µ–∑ Supabase CLI (–ø–æ—Å–ª–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏)**
```powershell
# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å CLI
npm install -g supabase

# –†–∞–∑–≤–µ—Ä–Ω—É—Ç—å
supabase login
supabase link --project-ref YOUR_PROJECT_REF
supabase functions deploy telegram-webhook
```

### 4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç—É –≤ –±–æ—Ç–µ

1. –û—Ç–ø—Ä–∞–≤—å—Ç–µ –±–æ—Ç—É –ª—é–±–æ–π –ø–æ–∏—Å–∫–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å
2. –ü—Ä–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –æ—Ç–∑—ã–≤—ã –º–µ—Å—Ç–∞
3. –í—ã–±–µ—Ä–∏—Ç–µ –º–µ—Å—Ç–æ
4. –ü–æ—Å—Ç—Ä–æ–π—Ç–µ –º–∞—Ä—à—Ä—É—Ç (–µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–Ω–æ)

### 5. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∑–∞–ø–∏—Å—å –¥–∞–Ω–Ω—ã—Ö

```sql
-- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é –ø–æ–∏—Å–∫–∞
SELECT 
    search_id,
    query_text,
    results_count,
    top_result->>'name' as top_place,
    timestamp
FROM search_history
ORDER BY timestamp DESC
LIMIT 5;

-- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–µ–π—Å—Ç–≤–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
SELECT 
    action_id,
    user_id,
    action_type,
    place_id,
    created_at
FROM user_actions
ORDER BY created_at DESC
LIMIT 10;

-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –¥–µ–π—Å—Ç–≤–∏—è–º
SELECT 
    action_type,
    COUNT(*) as count
FROM user_actions
GROUP BY action_type
ORDER BY count DESC;
```

### 6. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ

```sql
-- –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å —á—Ç–æ –≤ –∫—ç—à–µ
SELECT 
    place_id,
    name,
    last_fetched_at,
    cache_expires_at > NOW() as is_valid
FROM places_cache
ORDER BY last_fetched_at DESC
LIMIT 10;
```

## ‚ö†Ô∏è –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### –ü—Ä–æ–±–ª–µ–º–∞: –¢–∞–±–ª–∏—Ü—ã –Ω–µ —Å–æ–∑–¥–∞—é—Ç—Å—è
**–†–µ—à–µ–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ service role key –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö –ø—Ä–æ–µ–∫—Ç–∞

### –ü—Ä–æ–±–ª–µ–º–∞: –§—É–Ω–∫—Ü–∏–∏ –Ω–µ –≤–∏–¥—è—Ç –Ω–æ–≤—ã–µ —Ç–∞–±–ª–∏—Ü—ã
**–†–µ—à–µ–Ω–∏–µ:** –ü–µ—Ä–µ—Å–æ–∑–¥–∞–π—Ç–µ —Ñ—É–Ω–∫—Ü–∏—é —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–º --no-verify-jwt

### –ü—Ä–æ–±–ª–µ–º–∞: –ö—ç—à –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç
**–†–µ—à–µ–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ GeminiClient –ø–æ–ª—É—á–∞–µ—Ç supabaseUrl –∏ supabaseKey –≤ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–µ

### –ü—Ä–æ–±–ª–µ–º–∞: –ò—Å—Ç–æ—Ä–∏—è –Ω–µ –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è
**–†–µ—à–µ–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –ø–æ–ª—è results_count –∏ top_result –¥–æ–±–∞–≤–ª–µ–Ω—ã –≤ —Ç–∞–±–ª–∏—Ü—É

## ‚úÖ –ö—Ä–∏—Ç–µ—Ä–∏–∏ —É—Å–ø–µ—à–Ω–æ–≥–æ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è

- [ ] –ú–∏–≥—Ä–∞—Ü–∏–∏ –ø—Ä–∏–º–µ–Ω–µ–Ω—ã –±–µ–∑ –æ—à–∏–±–æ–∫
- [ ] –¢–∞–±–ª–∏—Ü—ã —Å–æ–∑–¥–∞–Ω—ã/–æ–±–Ω–æ–≤–ª–µ–Ω—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- [ ] Edge Functions –æ–±–Ω–æ–≤–ª–µ–Ω—ã
- [ ] –ë–æ—Ç –æ—Ç–≤–µ—á–∞–µ—Ç –Ω–∞ –∑–∞–ø—Ä–æ—Å—ã
- [ ] search_history –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è —Å –Ω–æ–≤—ã–º–∏ –ø–æ–ª—è–º–∏
- [ ] user_actions –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ –¥–µ–π—Å—Ç–≤–∏—è—Ö
- [ ] places_cache –∑–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è –ø—Ä–∏ –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–∞—Ö

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø–æ—Å–ª–µ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è

### –ü–µ—Ä–≤—ã–µ 24 —á–∞—Å–∞:
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–∑–º–µ—Ä —Ç–∞–±–ª–∏—Ü—ã user_actions
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –∫—ç—à–∞ (–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø–∏—Å–µ–π)
- –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –Ω–µ—Ç –æ—à–∏–±–æ–∫ –≤ –ª–æ–≥–∞—Ö Edge Functions

### –ß–µ—Ä–µ–∑ –Ω–µ–¥–µ–ª—é:
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –¥–µ–π—Å—Ç–≤–∏–π
- –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ø—É–ª—è—Ä–Ω–æ—Å—Ç—å –º–µ—Å—Ç
- –û—Ü–µ–Ω–∏—Ç—å —ç–∫–æ–Ω–æ–º–∏—é –Ω–∞ API –∑–∞–ø—Ä–æ—Å–∞—Ö

## üîó –ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏

- üìñ [–ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç](Docs/QUICK_DEPLOY_ANALYTICS.md)
- üìä [–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π –æ—Ç—á–µ—Ç](Docs/ANALYTICS_IMPLEMENTATION_REPORT.md)
- üóÉÔ∏è [–†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –º–∏–≥—Ä–∞—Ü–∏—è–º](Docs/DATABASE_MIGRATION_GUIDE.md)
- üìù [Changelog](CHANGELOG_ANALYTICS.md)

---

**–ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –≤—Å–µ—Ö —à–∞–≥–æ–≤ —Å–∏—Å—Ç–µ–º–∞ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ –±—É–¥–µ—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–∞–±–æ—Ç–∞—Ç—å!** üéâ


